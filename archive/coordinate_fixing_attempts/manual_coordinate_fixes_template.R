# MANUAL COORDINATE FIXES TEMPLATE
# Copy the URLs below into Google Maps, get the @lat,lng coordinates, and paste them here
# Format: place_title = c(lat, lng)

manual_fixes <- list(
  # Carnelian Coffee (7.1 mi, distant)
  # URL: https://www.google.com/maps/place/Carnelian+Coffee/data=!4m2!3m1!1s0x5495a015b7b62827:0x5547bcc2ca172b29
  Carnelian_Coffee = c(45.48354, -122.581559),  # REPLACE WITH REAL COORDS

  # Grand Central Bakery - Mississippi cafe (6.8 mi, distant)
  # URL: https://www.google.com/maps/place/Grand+Central+Bakery+-+Mississippi+cafe/data=!4m2!3m1!1s0x5495a7418e76f371:0xa34077211a8a89dd
  Grand_Central_Bakery_Mississippi_cafe = c(45.467269, -122.712074),  # REPLACE WITH REAL COORDS

  # Mother's Bistro & Bar (5.5 mi, distant)
  # URL: https://www.google.com/maps/place/Mother's+Bistro+%26+Bar/data=!4m2!3m1!1s0x54950a06702a5de5:0x880b0bcd938f8871
  Mother_s_Bistro_Bar = c(45.519453218742, -122.580729085541),  # REPLACE WITH REAL COORDS

  # Albina Press (5.5 mi, distant)
  # URL: https://www.google.com/maps/place/Albina+Press/data=!4m2!3m1!1s0x5495a7132430431b:0x1ee724c4aeb7666
  Albina_Press = c(45.4850944136754, -122.70174132717),  # REPLACE WITH REAL COORDS

  # Gabriel's Bakery (5.5 mi, distant)
  # URL: https://www.google.com/maps/place/Gabriel's+Bakery/data=!4m2!3m1!1s0x549509fc723eb285:0x4e092dafd06eecb5
  Gabriel_s_Bakery = c(45.4848994581895, -122.701003667063),  # REPLACE WITH REAL COORDS

  # Pittock Mansion (5.4 mi, distant)
  # URL: https://www.google.com/maps/place/Pittock+Mansion/data=!4m2!3m1!1s0x549509920bd06f53:0xbfea2f6e1ea1c0fa
  Pittock_Mansion = c(45.5190714718432, -122.582702462723),  # REPLACE WITH REAL COORDS

  # Puff Coffee (5.4 mi, distant)
  # URL: https://www.google.com/maps/place/Puff+Coffee/data=!4m2!3m1!1s0x5495a18821692719:0x6a34850e59f3dff0
  Puff_Coffee = c(45.523544519343, -122.579535770604),  # REPLACE WITH REAL COORDS

  # Blossoming Lotus (5.3 mi, distant)
  # URL: https://www.google.com/maps/place/Blossoming+Lotus/data=!4m2!3m1!1s0x5495a0b54502159b:0x925132f58dc91d24
  Blossoming_Lotus = c(45.5220613849065, -122.582127974748),  # REPLACE WITH REAL COORDS

  # MeKha Noodle (5.3 mi, distant)
  # URL: https://www.google.com/maps/place/MeKha+Noodle/data=!4m2!3m1!1s0x5495a1371e755a9f:0x8c50828e541cbc5f
  MeKha_Noodle = c(45.4872753787721, -122.70097091662),  # REPLACE WITH REAL COORDS

  # Kabba’s Kitchen (5.2 mi, distant)
  # URL: https://www.google.com/maps/place/Kabba%E2%80%99s+Kitchen/data=!4m2!3m1!1s0x5495a7fa1380247d:0x103aef8df22b077
  Kabba_s_Kitchen = c(45.5176049743704, -122.588167836739),  # REPLACE WITH REAL COORDS

  # All Your Heart Coffee (5.2 mi, distant)
  # URL: https://www.google.com/maps/place/All+Your+Heart+Coffee/data=!4m2!3m1!1s0x54950b6a81e3e733:0x622422e3b63abaa6
  All_Your_Heart_Coffee = c(45.5214006040792, -122.584936363267),  # REPLACE WITH REAL COORDS

  # Cloud City Ice Cream (5.1 mi, distant)
  # URL: https://www.google.com/maps/place/Cloud+City+Ice+Cream/data=!4m2!3m1!1s0x54950aa0c90fe67f:0x8a96585e19715cf3
  Cloud_City_Ice_Cream = c(45.5167360287963, -122.591231891039),  # REPLACE WITH REAL COORDS

  # Water Avenue Coffee Company (5.1 mi, distant)
  # URL: https://www.google.com/maps/place/Water+Avenue+Coffee+Company/data=!4m2!3m1!1s0x54950b00684951d7:0x22fa11b20aa06038
  Water_Avenue_Coffee_Company = c(45.5259957065429, -122.583271412782),  # REPLACE WITH REAL COORDS

  # Powell Butte Trailhead (5 mi, distant)
  # URL: https://www.google.com/maps/place/Powell+Butte+Trailhead/data=!4m2!3m1!1s0x54959f8d73e33877:0x941748e5c14b749f
  Powell_Butte_Trailhead = c(45.5161355875349, -122.594745219871),  # REPLACE WITH REAL COORDS

  # Oregon Historical Society (5 mi, distant)
  # URL: https://www.google.com/maps/place/Oregon+Historical+Society/data=!4m2!3m1!1s0x54950a1a91bd30e9:0xa1e159a76a17972d
  Oregon_Historical_Society = c(45.5269101922952, -122.584977089532),  # REPLACE WITH REAL COORDS

  # Laurelhurst Park (5 mi, distant)
  # URL: https://www.google.com/maps/place/Laurelhurst+Park/data=!4m2!3m1!1s0x5495a0eac4eeb42d:0xa26df736588d055e
  Laurelhurst_Park = c(45.6122823215231, -122.600055906893),  # REPLACE WITH REAL COORDS

  # Nationale (5 mi, distant)
  # URL: https://www.google.com/maps/place/Nationale/data=!4m2!3m1!1s0x5495a0a588ee74db:0x7ac44db9bf990d64
  Nationale = c(45.5152970904701, -122.597772878929),  # REPLACE WITH REAL COORDS

  # Cherries & Figs Wine Shop (5 mi, distant)
  # URL: https://www.google.com/maps/place/Cherries+%26+Figs+Wine+Shop/data=!4m2!3m1!1s0x5495a7140ba863c1:0x6bff9712cabd9d4c
  Cherries_Figs_Wine_Shop = c(45.492662934884, -122.704640979346),  # REPLACE WITH REAL COORDS

  # Bye and Bye (5 mi, distant)
  # URL: https://www.google.com/maps/place/Bye+and+Bye/data=!4m2!3m1!1s0x5495a71913f83e33:0x59407c50eb6ebb4e
  Bye_and_Bye = c(45.4913058118224, -122.699812868449),  # REPLACE WITH REAL COORDS

  # Kachka (5 mi, distant)
  # URL: https://www.google.com/maps/place/Kachka/data=!4m2!3m1!1s0x5495a0a7485bfdcd:0x859a3a4e9e7497eb
  Kachka = c(45.5233308261065, -122.588450084669),  # REPLACE WITH REAL COORDS

  # Posies Bakery & Cafe (5 mi, distant)
  # URL: https://www.google.com/maps/place/Posies+Bakery+%26+Cafe/data=!4m2!3m1!1s0x5495a7b72aada1bd:0x66e213d4003d996d
  Posies_Bakery_Cafe = c(45.4912048849259, -122.696207774886),  # REPLACE WITH REAL COORDS

  # Yours Truly (5 mi, distant)
  # URL: https://www.google.com/maps/place/Yours+Truly/data=!4m2!3m1!1s0x54950baaba389015:0xa113d0b83677d6a
  Yours_Truly = c(45.5330704551986, -122.579922943939),  # REPLACE WITH REAL COORDS

  # Japanese American Museum of Oregon (4.9 mi, distant)
  # URL: https://www.google.com/maps/place/Japanese+American+Museum+of+Oregon/data=!4m2!3m1!1s0x54950a00b0343773:0x97d045d1b6af935
  Japanese_American_Museum_of_Oregon = c(45.5257793373598, -122.587497485595),  # REPLACE WITH REAL COORDS

  # Hollywood Vintage (4.9 mi, distant)
  # URL: https://www.google.com/maps/place/Hollywood+Vintage/data=!4m2!3m1!1s0x5495a0c7d2355d2b:0x682e74ca1a216585
  Hollywood_Vintage = c(45.6241350497261, -122.726495968634),  # REPLACE WITH REAL COORDS

  # Portland Farmers Market - King (4.9 mi, distant)
  # URL: https://www.google.com/maps/place/Portland+Farmers+Market+-+King/data=!4m2!3m1!1s0x5495a719d411347d:0x49ef7f6422be5efa
  Portland_Farmers_Market_King = c(45.5286752716813, -122.585645140798),  # REPLACE WITH REAL COORDS

  # Broadway Books (4.9 mi, distant)
  # URL: https://www.google.com/maps/place/Broadway+Books/data=!4m2!3m1!1s0x5495a0ca9b531df1:0xf23a0806945ccc2f
  Broadway_Books = c(45.5143174420127, -122.602124304535),  # REPLACE WITH REAL COORDS

  # Always Here Bookstore (4.9 mi, distant)
  # URL: https://www.google.com/maps/place/Always+Here+Bookstore/data=!4m2!3m1!1s0x5495a7095250f737:0xb7b9a395829e17bc
  Always_Here_Bookstore = c(45.6002324380681, -122.590352460844),  # REPLACE WITH REAL COORDS

  # Face Plant (4.9 mi, distant)
  # URL: https://www.google.com/maps/place/Face+Plant/data=!4m2!3m1!1s0x5495a775c783a68d:0x1fe64b181a547823
  Face_Plant = c(45.518375571691, -122.596672452621),  # REPLACE WITH REAL COORDS

  # Mt. Tabor Park (4.8 mi, distant)
  # URL: https://www.google.com/maps/place/Mt.+Tabor+Park/data=!4m2!3m1!1s0x5495a0f881565735:0xb91a9046c3fce04a
  Mt_Tabor_Park = c(45.5222166409208, -122.5934067862),  # REPLACE WITH REAL COORDS

  # Mocks Crest (4.8 mi, distant)
  # URL: https://www.google.com/maps/place/Mocks+Crest/data=!4m2!3m1!1s0x5495a7700287a6ff:0x5e95861de4fb2aec
  Mocks_Crest = c(45.6126424062207, -122.743261556634),  # REPLACE WITH REAL COORDS

  # Umami Sushi Pdx Food Cart (4.8 mi, distant)
  # URL: https://www.google.com/maps/place/Umami+Sushi+Pdx+Food+Cart/data=!4m2!3m1!1s0x5495a7a810ac79eb:0x90470b8d2fa6a4c
  Umami_Sushi_Pdx_Food_Cart = c(45.6204830578297, -122.727765199272),  # REPLACE WITH REAL COORDS

  # Bao Bao (4.8 mi, distant)
  # URL: https://www.google.com/maps/place/Bao+Bao/data=!4m2!3m1!1s0x5495a17bfad148c9:0xfcc903b71fba1937
  Bao_Bao = c(45.4961986057642, -122.70410914212),  # REPLACE WITH REAL COORDS

  # Junior's Cafe (4.8 mi, distant)
  # URL: https://www.google.com/maps/place/Junior's+Cafe/data=!4m2!3m1!1s0x54950a758b301a97:0xb8f565bd973285ba
  Junior_s_Cafe = c(45.6288093661472, -122.702954017603),  # REPLACE WITH REAL COORDS

  # ASTERA (4.8 mi, distant)
  # URL: https://www.google.com/maps/place/ASTERA/data=!4m2!3m1!1s0x5495a132c73563af:0x1bc5e5c7036a8b7c
  ASTERA = c(45.6211970891014, -122.727479436947),  # REPLACE WITH REAL COORDS

  # Best Friend Juice Bar & Cafe (4.8 mi, distant)
  # URL: https://www.google.com/maps/place/Best+Friend+Juice+Bar+%26+Cafe/data=!4m2!3m1!1s0x54950b3d85a7490d:0xb9172920d41c0124
  Best_Friend_Juice_Bar_Cafe = c(45.4937288211924, -122.690529519666),  # REPLACE WITH REAL COORDS

  # Memoire Cà Phê (4.8 mi, distant)
  # URL: https://www.google.com/maps/place/Memoire+C%C3%A0+Ph%C3%AA/data=!4m2!3m1!1s0x5495a7d22219017d:0x6030664ab59d769c
  Memoire_C_Ph = c(45.5285475658982, -122.588754267405),  # REPLACE WITH REAL COORDS

  # Bipartisan Cafe (4.8 mi, distant)
  # URL: https://www.google.com/maps/place/Bipartisan+Cafe/data=!4m2!3m1!1s0x5495a106cfafcff1:0x3f71faa89ba7dcdc
  Bipartisan_Cafe = c(45.6257781892225, -122.715828722017),  # REPLACE WITH REAL COORDS

  # Keeper Coffee Co (4.8 mi, distant)
  # URL: https://www.google.com/maps/place/Keeper+Coffee+Co/data=!4m2!3m1!1s0x54950b1de95b50c1:0x81cb7d42ff5e6ae7
  Keeper_Coffee_Co = c(45.6077314365983, -122.601333109224),  # REPLACE WITH REAL COORDS

  # Next Adventure Portland Paddle Sports Center (4.7 mi, distant)
  # URL: https://www.google.com/maps/place/Next+Adventure+Portland+Paddle+Sports+Center/data=!4m2!3m1!1s0x5495a0a6daa4ebf9:0x8574945dba1049cb
  Next_Adventure_Portland_Paddle_Sports_Center = c(45.5334512949111, -122.58688295833),  # REPLACE WITH REAL COORDS

  # Word Virus Books (4.7 mi, distant)
  # URL: https://www.google.com/maps/place/Word+Virus+Books/data=!4m2!3m1!1s0x5495a12193f82bdb:0x92d7df216433539b
  Word_Virus_Books = c(45.608105048272, -122.746214711284),  # REPLACE WITH REAL COORDS

  # Exquisite Creatures Coffee (4.7 mi, distant)
  # URL: https://www.google.com/maps/place/Exquisite+Creatures+Coffee/data=!4m2!3m1!1s0x5495a34c62483999:0x45239e39f2ef9ac3
  Exquisite_Creatures_Coffee = c(45.5247573497649, -122.59550645155),  # REPLACE WITH REAL COORDS

  # MÅURICE (4.7 mi, distant)
  # URL: https://www.google.com/maps/place/M%C3%85URICE/data=!4m2!3m1!1s0x54950a03c051c9e7:0x95721c1a7a39b826
  M_URICE = c(45.5244479178069, -122.593628696106),  # REPLACE WITH REAL COORDS

  # Desperados Sandwiches (4.7 mi, distant)
  # URL: https://www.google.com/maps/place/Desperados+Sandwiches/data=!4m2!3m1!1s0x5495a701b5fb6457:0x20ab6b11565c0d90
  Desperados_Sandwiches = c(45.4954583969275, -122.689631938387),  # REPLACE WITH REAL COORDS

  # Avalon Theatre (4.6 mi, distant)
  # URL: https://www.google.com/maps/place/Avalon+Theatre/data=!4m2!3m1!1s0x5495a0937b4c1109:0xcca426e04f8117da
  Avalon_Theatre = c(45.5956648749068, -122.756720216954),  # REPLACE WITH REAL COORDS

  # Powell Butte Nature Park (4.6 mi, distant)
  # URL: https://www.google.com/maps/place/Powell+Butte+Nature+Park/data=!4m2!3m1!1s0x54959f449b3bdd11:0xa38faa35582a3ddf
  Powell_Butte_Nature_Park = c(45.6101279753029, -122.740176739106),  # REPLACE WITH REAL COORDS

  # H Mart Belmont (4.6 mi, distant)
  # URL: https://www.google.com/maps/place/H+Mart+Belmont/data=!4m2!3m1!1s0x5495a14571766bef:0xaa8576f85bcf57fb
  H_Mart_Belmont = c(45.5066749569541, -122.623310313595),  # REPLACE WITH REAL COORDS

  # Lost Avenue Books (4.6 mi, distant)
  # URL: https://www.google.com/maps/place/Lost+Avenue+Books/data=!4m2!3m1!1s0x5495a74182fa8de1:0x726bc3ead15337b1
  Lost_Avenue_Books = c(45.4960571583784, -122.679444818192),  # REPLACE WITH REAL COORDS

  # Hopscotch Portland (4.6 mi, distant)
  # URL: https://www.google.com/maps/place/Hopscotch+Portland/data=!4m2!3m1!1s0x5495a10000cec041:0x668987136e182301
  Hopscotch_Portland = c(45.5242169590511, -122.598690311378),  # REPLACE WITH REAL COORDS

  # Fried Egg I'm In Love (4.6 mi, distant)
  # URL: https://www.google.com/maps/place/Fried+Egg+I'm+In+Love/data=!4m2!3m1!1s0x5495a04721dd7373:0x2e9d7c6479edc2df
  Fried_Egg_I_m_In_Love = c(45.5050739508411, -122.626911810856),  # REPLACE WITH REAL COORDS

  # Farag’s (4.6 mi, distant)
  # URL: https://www.google.com/maps/place/Farag%E2%80%99s/data=!4m2!3m1!1s0x5495a1002ae78b11:0xb23a3aa97b7b6c4e
  Farag_s = c(45.5278435671532, -122.594359003523),  # REPLACE WITH REAL COORDS

)

# APPLY FIXES CODE
library(dplyr)
data <- readRDS("data/portland_places_processed.rds")

HOME_LAT <- 45.5623
HOME_LNG <- -122.6754

calc_distance_miles <- function(lat, lng, home_lat = HOME_LAT, home_lng = HOME_LNG) {
  R <- 3959
  lat1 <- home_lat * pi/180
  lat2 <- lat * pi/180
  dlat <- (lat - home_lat) * pi/180
  dlng <- (lng - home_lng) * pi/180
  
  a <- sin(dlat/2)^2 + cos(lat1) * cos(lat2) * sin(dlng/2)^2
  c <- 2 * atan2(sqrt(a), sqrt(1-a))
  
  round(R * c, 1)
}

# Apply manual fixes
improvements <- 0
for(fix_name in names(manual_fixes)) {
  coords <- manual_fixes[[fix_name]]
  if(length(coords) == 2 && all(is.numeric(coords))) {
    # Find matching place (fuzzy match on title)
    title_pattern <- gsub("_", ".*", fix_name)
    matches <- grep(title_pattern, data$title, ignore.case = TRUE)
    
    if(length(matches) > 0) {
      idx <- matches[1]  # Take first match
      old_distance <- data$distance_mi[idx]
      new_distance <- calc_distance_miles(coords[1], coords[2])
      
      cat("UPDATING:", data$title[idx], "\n")
      cat("  OLD:", round(data$lat[idx], 4), round(data$lng[idx], 4), "(", old_distance, "mi)")
      cat(" -> NEW:", round(coords[1], 4), round(coords[2], 4), "(", new_distance, "mi)\n\n")
      
      data$lat[idx] <- coords[1]
      data$lng[idx] <- coords[2]
      data$distance_mi[idx] <- new_distance
      improvements <- improvements + 1
    }
  }
}

if(improvements > 0) {
  saveRDS(data, "data/portland_places_processed.rds")
  cat("\nData saved with", improvements, "manual coordinate fixes\n")
}

